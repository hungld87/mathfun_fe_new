{
    "sourceFile": "components/AppHeader.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1765278856429,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765338987826,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -197,10 +197,27 @@\n         </nav>\n \n         <!-- Mobile Menu Footer -->\n         <div class=\"p-4 border-t border-gray-200 space-y-2\">\n+          <!-- If user is logged in, show user info + logout -->\n+          <div v-if=\"currentUser\" class=\"bg-gray-50 rounded-lg p-4\">\n+            <div class=\"flex items-center gap-3\">\n+              <div class=\"w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center font-bold\">\n+                {{ (currentUser.username || 'U').charAt(0).toUpperCase() }}\n+              </div>\n+              <div class=\"flex-1\">\n+                <p class=\"text-sm font-semibold text-gray-900 truncate\">{{ currentUser.username }}</p>\n+                <p class=\"text-xs text-gray-500 truncate\">{{ currentUser.email }}</p>\n+              </div>\n+            </div>\n+            <div class=\"mt-3 flex gap-2\">\n+              <button @click=\"() => { closeMenu(); navigateTo('/profile') }\" class=\"flex-1 px-4 py-2 border border-gray-200 rounded-lg text-sm font-medium hover:bg-gray-100\">Tài khoản</button>\n+              <button @click=\"handleLogout\" class=\"flex-1 px-4 py-2 bg-red-50 text-red-600 rounded-lg text-sm font-medium hover:bg-red-100\">Đăng xuất</button>\n+            </div>\n+          </div>\n+          <!-- Otherwise show login button -->\n           <button \n-            v-if=\"buttons.login.enabled\"\n+            v-else-if=\"buttons.login.enabled\"\n             @click=\"openAuthModal\"\n             class=\"w-full flex items-center justify-center gap-2 px-4 py-3 text-teal-600 border-2 border-teal-600 rounded-lg hover:bg-teal-50 transition font-medium\"\n           >\n             <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n@@ -314,9 +331,9 @@\n   closeMenu() // Close mobile menu if open\n }\n \n const handleAuthSuccess = (data) => {\n-  console.log('Auth success:', data)\n+  // console.log('Auth success:', data)\n   // Update current user from auth response\n   if (data.user) {\n     currentUser.value = data.user\n   }\n"
                },
                {
                    "date": 1765349302596,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,10 @@\n             <div class=\"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded flex items-center justify-center\">\n               <span class=\"font-bold text-white text-lg\">{{ (logo.text || 'M').charAt(0) }}</span>\n             </div>\n           </div>\n-          <div class=\"text-white\">\n+          <!-- Hide logo text on mobile, show on md and up -->\n+          <div class=\"text-white hidden md:block\">\n             <div v-if=\"logo.sub_text\" class=\"text-xs font-medium opacity-90\">{{ logo.sub_text }}</div>\n             <div class=\"text-lg font-bold\" :class=\"{ '-mt-1': logo.sub_text }\">{{ logo.text || 'MATHFUN' }}</div>\n           </div>\n         </NuxtLink>\n"
                },
                {
                    "date": 1765351851790,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -248,9 +248,9 @@\n \n     <!-- Auth Modal -->\n     <AuthModal \n       :is-open=\"isAuthModalOpen\"\n-      @close=\"isAuthModalOpen = false\"\n+      @close=\"closeAuthModal\"\n       @success=\"handleAuthSuccess\"\n     />\n   </header>\n </template>\n@@ -278,8 +278,17 @@\n     }\n   }\n })\n \n+// Watch route changes to ensure menu is closed\n+const route = useRoute()\n+watch(() => route.path, () => {\n+  closeMenu()\n+  closeAuthModal()\n+  isConsultationModalOpen.value = false\n+  isUserMenuOpen.value = false\n+})\n+\n // Load global config\n const { data: globalConfig } = await useAsyncData('global-config-header', () => $fetch('/api/mock/global'))\n \n // console.log('===== HEADER GLOBAL CONFIG =====')\n@@ -327,18 +336,26 @@\n   // Here you can send data to your API\n }\n \n const openAuthModal = () => {\n-  isAuthModalOpen.value = true\n-  closeMenu() // Close mobile menu if open\n+  closeMenu() // Close mobile menu first\n+  // Use nextTick to ensure menu is closed before opening modal\n+  nextTick(() => {\n+    isAuthModalOpen.value = true\n+  })\n }\n \n+const closeAuthModal = () => {\n+  isAuthModalOpen.value = false\n+}\n+\n const handleAuthSuccess = (data) => {\n   // console.log('Auth success:', data)\n   // Update current user from auth response\n   if (data.user) {\n     currentUser.value = data.user\n   }\n+  closeAuthModal()\n }\n \n const handleLogout = () => {\n   if (process.client) {\n"
                }
            ],
            "date": 1765278856429,
            "name": "Commit-0",
            "content": "<template>\n  <header class=\"sticky top-0 z-50 shadow-md\">\n    <!-- Top Bar - Teal Background -->\n    <div class=\"bg-gradient-to-r from-teal-500 to-teal-600\" style=\"background: linear-gradient(90deg, #3FB3AA 0%, #45BEB5 100%);\">\n      <div class=\"container mx-auto px-6 max-w-content flex items-center justify-between py-3\">\n        <!-- Mobile Menu Button -->\n        <button \n          @click=\"toggleMenu\" \n          class=\"md:hidden text-white p-2 hover:bg-white/10 rounded-lg transition\"\n          aria-label=\"Toggle menu\"\n        >\n          <svg v-if=\"!isMenuOpen\" class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path>\n          </svg>\n          <svg v-else class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n          </svg>\n        </button>\n\n        <!-- Logo -->\n        <NuxtLink :to=\"logo.link || '/'\" class=\"flex items-center gap-2 hover:opacity-90 transition\">\n          <div v-if=\"logo.icon\" class=\"bg-white rounded-lg p-1.5 shadow-sm\">\n            <img :src=\"logo.icon\" :alt=\"logo.text\" class=\"w-8 h-8 object-contain\" />\n          </div>\n          <div v-else class=\"bg-white rounded-lg p-1.5 shadow-sm\">\n            <div class=\"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded flex items-center justify-center\">\n              <span class=\"font-bold text-white text-lg\">{{ (logo.text || 'M').charAt(0) }}</span>\n            </div>\n          </div>\n          <div class=\"text-white\">\n            <div v-if=\"logo.sub_text\" class=\"text-xs font-medium opacity-90\">{{ logo.sub_text }}</div>\n            <div class=\"text-lg font-bold\" :class=\"{ '-mt-1': logo.sub_text }\">{{ logo.text || 'MATHFUN' }}</div>\n          </div>\n        </NuxtLink>\n\n        <!-- Search Bar -->\n        <div class=\"hidden md:flex flex-1 max-w-2xl mx-8\">\n          <div class=\"relative w-full\">\n            <input \n              type=\"text\" \n              :placeholder=\"search.placeholder || 'Tìm kiếm khóa học, bài tập, tài liệu...'\"\n              class=\"w-full px-5 py-3 pr-12 rounded-full text-gray-700 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/30 shadow-md\"\n            />\n            <button class=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 hover:bg-gray-100 rounded-full transition\">\n              <svg class=\"w-5 h-5 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"></path>\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <!-- Actions -->\n        <div class=\"flex items-center gap-3\">\n          <!-- User Menu (when logged in) -->\n          <div v-if=\"currentUser\" class=\"relative hidden sm:block\">\n            <button \n              @click=\"toggleUserMenu\"\n              class=\"flex items-center gap-2 text-white hover:bg-white/10 px-4 py-2 rounded-full transition font-medium\"\n            >\n              <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n              </svg>\n              <span>{{ currentUser.username }}</span>\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"></path>\n              </svg>\n            </button>\n            \n            <!-- Dropdown Menu -->\n            <Transition name=\"fade\">\n              <div v-if=\"isUserMenuOpen\" class=\"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50\">\n                <div class=\"px-4 py-2 border-b border-gray-100\">\n                  <p class=\"text-sm font-semibold text-gray-900\">{{ currentUser.username }}</p>\n                  <p class=\"text-xs text-gray-500\">{{ currentUser.email }}</p>\n                </div>\n                <button \n                  @click=\"handleLogout\"\n                  class=\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition flex items-center gap-2\"\n                >\n                  <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"></path>\n                  </svg>\n                  Đăng xuất\n                </button>\n              </div>\n            </Transition>\n          </div>\n\n          <!-- Login Button (when not logged in) -->\n          <button \n            v-else-if=\"buttons.login.enabled\"\n            @click=\"openAuthModal\"\n            class=\"hidden sm:flex items-center gap-2 text-white hover:bg-white/10 px-4 py-2 rounded-full transition font-medium\"\n          >\n            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n            </svg>\n            <span>{{ buttons.login.text }}</span>\n          </button>\n\n          <button \n            v-if=\"buttons.consultation.enabled\"\n            @click=\"openConsultationModal\"\n            class=\"bg-gradient-to-r from-orange-400 to-orange-500 text-white px-5 py-2.5 rounded-full font-semibold hover:shadow-lg hover:scale-105 transition-all flex items-center gap-2\"\n          >\n            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n            </svg>\n            <span>{{ buttons.consultation.text }}</span>\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Bottom Navigation Bar - Desktop Only -->\n    <div class=\"hidden md:block bg-white border-b border-gray-200\">\n      <div class=\"container mx-auto px-6 max-w-content\">\n        <nav class=\"flex items-center gap-1 text-sm font-medium overflow-x-auto\">\n          <NuxtLink \n            v-for=\"item in navigation\"\n            :key=\"item.id\"\n            :to=\"item.link\" \n            :exact=\"item.link === '/'\"\n            class=\"flex items-center gap-2 px-4 py-3 hover:text-teal-600 hover:bg-teal-50 transition whitespace-nowrap border-b-2 border-transparent hover:border-teal-600\"\n            :class=\"{ \n              'text-orange-600 font-semibold hover:bg-orange-50 hover:border-orange-600': item.highlight,\n              'active-class': 'text-teal-600 bg-teal-50 border-teal-600'\n            }\"\n            active-class=\"text-teal-600 bg-teal-50 border-teal-600\"\n          >\n            <img v-if=\"item.icon?.url\" :src=\"getImageUrl(item.icon.url)\" :alt=\"item.label\" class=\"w-5 h-5 object-contain\" />\n            <span>{{ item.label }}</span>\n          </NuxtLink>\n        </nav>\n      </div>\n    </div>\n\n    <!-- Mobile Menu Overlay -->\n    <Transition name=\"fade\">\n      <div \n        v-if=\"isMenuOpen\" \n        class=\"fixed inset-0 bg-black/50 md:hidden z-40\"\n        @click=\"closeMenu\"\n      ></div>\n    </Transition>\n\n    <!-- Mobile Menu Slide-in -->\n    <Transition name=\"slide\">\n      <div \n        v-if=\"isMenuOpen\" \n        class=\"fixed top-0 left-0 h-full w-80 max-w-[85vw] bg-white shadow-2xl md:hidden z-50 overflow-y-auto\"\n      >\n        <!-- Mobile Menu Header -->\n        <div class=\"bg-gradient-to-r from-teal-500 to-teal-600 p-6 flex items-center justify-between\">\n          <div class=\"flex items-center gap-2\">\n            <div v-if=\"logo.icon\" class=\"bg-white rounded-lg p-1.5 shadow-sm\">\n              <img :src=\"logo.icon\" :alt=\"logo.text\" class=\"w-8 h-8 object-contain\" />\n            </div>\n            <div v-else class=\"bg-white rounded-lg p-1.5 shadow-sm\">\n              <div class=\"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded flex items-center justify-center\">\n                <span class=\"font-bold text-white text-lg\">{{ (logo.text || 'M').charAt(0) }}</span>\n              </div>\n            </div>\n            <div class=\"text-white\">\n              <div v-if=\"logo.sub_text\" class=\"text-xs font-medium opacity-90\">{{ logo.sub_text }}</div>\n              <div class=\"text-lg font-bold\" :class=\"{ '-mt-1': logo.sub_text }\">{{ logo.text || 'MATHFUN' }}</div>\n            </div>\n          </div>\n          <button @click=\"closeMenu\" class=\"text-white p-2 hover:bg-white/10 rounded-lg transition\">\n            <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n            </svg>\n          </button>\n        </div>\n\n        <!-- Mobile Menu Items -->\n        <nav class=\"p-4\">\n          <NuxtLink \n            v-for=\"item in navigation\"\n            :key=\"item.id\"\n            :to=\"item.link\" \n            :exact=\"item.link === '/'\"\n            @click=\"closeMenu\"\n            class=\"flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-teal-50 hover:text-teal-600 rounded-lg transition mb-1\"\n            :class=\"{ \n              'text-orange-600 bg-orange-50 hover:bg-orange-100': item.highlight,\n              'font-semibold': item.highlight\n            }\"\n            active-class=\"bg-teal-50 text-teal-600 font-semibold\"\n          >\n            <img v-if=\"item.icon?.url\" :src=\"getImageUrl(item.icon.url)\" :alt=\"item.label\" class=\"w-5 h-5 object-contain\" />\n            <svg v-else class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"></path>\n            </svg>\n            <span :class=\"{ 'font-semibold': item.highlight, 'font-medium': !item.highlight }\">{{ item.label }}</span>\n          </NuxtLink>\n        </nav>\n\n        <!-- Mobile Menu Footer -->\n        <div class=\"p-4 border-t border-gray-200 space-y-2\">\n          <button \n            v-if=\"buttons.login.enabled\"\n            @click=\"openAuthModal\"\n            class=\"w-full flex items-center justify-center gap-2 px-4 py-3 text-teal-600 border-2 border-teal-600 rounded-lg hover:bg-teal-50 transition font-medium\"\n          >\n            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"></path>\n            </svg>\n            <span>{{ buttons.login.text }}</span>\n          </button>\n          <button \n            v-if=\"buttons.consultation.enabled\"\n            @click=\"openConsultationModal\"\n            class=\"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-orange-400 to-orange-500 text-white rounded-lg hover:shadow-lg transition font-semibold\"\n          >\n            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"></path>\n            </svg>\n            <span>{{ buttons.consultation.text }}</span>\n          </button>\n        </div>\n      </div>\n    </Transition>\n\n    <!-- Consultation Modal -->\n    <ConsultationModal \n      v-model=\"isConsultationModalOpen\"\n      @submit=\"handleConsultationSubmit\"\n    />\n\n    <!-- Auth Modal -->\n    <AuthModal \n      :is-open=\"isAuthModalOpen\"\n      @close=\"isAuthModalOpen = false\"\n      @success=\"handleAuthSuccess\"\n    />\n  </header>\n</template>\n\n<script setup>\n// Use useState for persistent state across page navigation\nconst isMenuOpen = ref(false)\nconst isConsultationModalOpen = useState('consultation-modal-open', () => false)\nconst isAuthModalOpen = useState('auth-modal-open', () => false)\nconst isUserMenuOpen = ref(false)\n\n// Current user state\nconst currentUser = ref(null)\n\n// Load user from localStorage on mount\nonMounted(() => {\n  if (process.client) {\n    const userStr = localStorage.getItem('user')\n    if (userStr) {\n      try {\n        currentUser.value = JSON.parse(userStr)\n      } catch (e) {\n        console.error('Failed to parse user data:', e)\n      }\n    }\n  }\n})\n\n// Load global config\nconst { data: globalConfig } = await useAsyncData('global-config-header', () => $fetch('/api/mock/global'))\n\n// console.log('===== HEADER GLOBAL CONFIG =====')\n// console.log('globalConfig:', globalConfig.value)\n// console.log('header:', globalConfig.value?.data?.header)\n// console.log('search:', globalConfig.value?.data?.header?.search)\n// console.log('search.placeholder:', globalConfig.value?.data?.header?.search?.placeholder)\n\n// Helper to build full URL for images from Strapi\nconst config = useRuntimeConfig()\nconst strapiBaseUrl = config.public.apiBase?.replace('/api', '') || 'http://localhost:1337'\n\nconst getImageUrl = (url) => {\n  if (!url) return ''\n  if (url.startsWith('http')) return url\n  return `${strapiBaseUrl}${url}`\n}\n\n// Computed properties for header data\nconst header = computed(() => globalConfig.value?.data?.header || {})\nconst logo = computed(() => header.value.logo || { text: 'MATHFUN', sub_text: '', icon: '', link: '/' })\nconst search = computed(() => header.value.search || { placeholder: 'Tìm kiếm khóa học, bài tập, tài liệu...' })\nconst navigation = computed(() => header.value.navigation || [])\nconst buttons = computed(() => header.value.buttons || { login: { text: 'Đăng nhập', enabled: true }, consultation: { text: 'Yêu cầu tư vấn', enabled: true } })\n\nconst toggleMenu = () => {\n  isMenuOpen.value = !isMenuOpen.value\n}\n\nconst closeMenu = () => {\n  isMenuOpen.value = false\n}\n\nconst toggleUserMenu = () => {\n  isUserMenuOpen.value = !isUserMenuOpen.value\n}\n\nconst openConsultationModal = () => {\n  isConsultationModalOpen.value = true\n  closeMenu() // Close mobile menu if open\n}\n\nconst handleConsultationSubmit = (data) => {\n  console.log('Consultation data:', data)\n  // Here you can send data to your API\n}\n\nconst openAuthModal = () => {\n  isAuthModalOpen.value = true\n  closeMenu() // Close mobile menu if open\n}\n\nconst handleAuthSuccess = (data) => {\n  console.log('Auth success:', data)\n  // Update current user from auth response\n  if (data.user) {\n    currentUser.value = data.user\n  }\n}\n\nconst handleLogout = () => {\n  if (process.client) {\n    localStorage.removeItem('jwt')\n    localStorage.removeItem('user')\n    currentUser.value = null\n    isUserMenuOpen.value = false\n  }\n  // Optionally reload the page or redirect\n  window.location.reload()\n}\n\n// Close user menu when clicking outside\nif (process.client) {\n  document.addEventListener('click', (e) => {\n    if (isUserMenuOpen.value && !e.target.closest('.relative')) {\n      isUserMenuOpen.value = false\n    }\n  })\n}\n</script>\n\n<style scoped>\n/* Fade transition for overlay */\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.3s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n}\n\n/* Slide transition for menu */\n.slide-enter-active,\n.slide-leave-active {\n  transition: transform 0.3s ease;\n}\n\n.slide-enter-from,\n.slide-leave-to {\n  transform: translateX(-100%);\n}\n</style>\n"
        }
    ]
}